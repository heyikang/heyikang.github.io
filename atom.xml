<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>KangKang - 个人博客</title>
  
  <subtitle>KangKang</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://heyikang.me/"/>
  <updated>2018-10-11T11:13:45.623Z</updated>
  <id>https://heyikang.me/</id>
  
  <author>
    <name>KangKang</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>页面无刷新传递数据</title>
    <link href="https://heyikang.me/2018/04/28/%E9%A1%B5%E9%9D%A2%E6%97%A0%E5%88%B7%E6%96%B0%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE/"/>
    <id>https://heyikang.me/2018/04/28/页面无刷新传递数据/</id>
    <published>2018-04-28T07:46:03.000Z</published>
    <updated>2018-10-11T11:13:45.623Z</updated>
    
    <content type="html"><![CDATA[<p>放假的前一天总是这么无聊。<br>枯燥的工作想放松一下，点开了<a href="https://y.qq.com" target="_blank" rel="noopener">QQ音乐Web版本</a>。<br>当我选择一个歌单的时候会弹出一个新的页面，音乐开始播放。<br>然后我点击另外一个歌单，播放页面竟然自动更换了歌曲，此时页面并没有刷新，并且没有Socket连接，没有Ajax请求。WTF！</p><a id="more"></a><h2 id="寻找答案"><a href="#寻找答案" class="headerlink" title="寻找答案"></a>寻找答案</h2><p>也想过cookie,WebSocket,session。但似乎忽略了什么。</p><ul><li><code>localStorage</code></li><li><code>sessionStorage</code></li></ul><blockquote><p>什么是 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/localStorage" target="_blank" rel="noopener">localStorage</a>？<br>什么是 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/sessionStorage" target="_blank" rel="noopener">sessionStorage</a>？</p></blockquote><h2 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h2><p>仅上关键部分javaScript代码</p><ul><li>页面 1</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localStorage.setItem(<span class="string">'page1'</span>,<span class="string">'我是页面1数据'</span>)</span><br></pre></td></tr></table></figure><ul><li>页面 2</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">addEventListener(<span class="string">'storage'</span>, e =&gt; &#123;</span><br><span class="line">  <span class="comment">// 如果localStorage 数据改变 监听事件将会被触发</span></span><br><span class="line">  <span class="comment">// 实测 仅在相同域名下生效 且改变的值与上次的值一样此监听事件不会触发</span></span><br><span class="line">  <span class="comment">// 实测 用 file: 协议无法正确监听 storage 事件 但是 数据可以正确写入</span></span><br><span class="line">  <span class="comment">// 并且 file：下可以通过Chrome F12调试工具看到数据改变 就是 无法监听到数据的改变</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;放假的前一天总是这么无聊。&lt;br&gt;枯燥的工作想放松一下，点开了&lt;a href=&quot;https://y.qq.com&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;QQ音乐Web版本&lt;/a&gt;。&lt;br&gt;当我选择一个歌单的时候会弹出一个新的页面，音乐开始播放。&lt;br&gt;然后我点击另外一个歌单，播放页面竟然自动更换了歌曲，此时页面并没有刷新，并且没有Socket连接，没有Ajax请求。WTF！&lt;/p&gt;
    
    </summary>
    
    
      <category term="JavaScript" scheme="https://heyikang.me/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>树莓派3B 安装Nginx</title>
    <link href="https://heyikang.me/2018/03/12/%E6%A0%91%E8%8E%93%E6%B4%BE3B-%E5%AE%89%E8%A3%85Nginx/"/>
    <id>https://heyikang.me/2018/03/12/树莓派3B-安装Nginx/</id>
    <published>2018-03-12T14:27:04.000Z</published>
    <updated>2018-10-11T11:13:45.620Z</updated>
    
    <content type="html"><![CDATA[<p>主要记录<strong>armv7l</strong>平台安装Nginx过程</p><h2 id="安装编译环境"><a href="#安装编译环境" class="headerlink" title="安装编译环境"></a>安装编译环境</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install -y gcc-c++ pcre pcre-devel zliv zliv-devel zliv zliv-devel openssl openssl-devel wget</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://nginx.org/download/nginx-1.12.2.tar.gz <span class="comment"># 下载安装包</span></span><br><span class="line">$ tar -zxvf nginx-1.12.2.tar.gz <span class="comment"># 解压</span></span><br><span class="line">$ <span class="built_in">cd</span> nginx-1.12.2.tar.gz <span class="comment"># 进入文件夹</span></span><br><span class="line"><span class="comment"># 编译前准备工作</span></span><br><span class="line">$ mkdir -p /usr/<span class="built_in">local</span>/nginx <span class="comment"># 创建文件夹</span></span><br><span class="line">$ ./configure --prefix=/usr/<span class="built_in">local</span>/ --with-http_ssl_module \</span><br><span class="line">    --with-http_v2_module \</span><br><span class="line">    --with-http_stub_status_module</span><br><span class="line"><span class="comment"># --prefix=/usr/local/ &gt; 指定路径</span></span><br><span class="line"><span class="comment"># --with-http_ssl_module &gt; 启用SSL</span></span><br><span class="line"><span class="comment"># --with-http_v2_module &gt; 启用httpv2</span></span><br><span class="line"><span class="comment"># 编译并安装</span></span><br><span class="line">$ make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h2 id="配置防火墙"><a href="#配置防火墙" class="headerlink" title="配置防火墙"></a>配置防火墙</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ firewall-cmd --permanent --zone=public --add-service=http  <span class="comment">#启用http</span></span><br><span class="line">$ firewall-cmd --permanent --zone=pbblic --add-service=https  <span class="comment">#启用https</span></span><br><span class="line"><span class="comment"># 上下两种方法选其一</span></span><br><span class="line">$ firewall-cmd --permanent --zone=public --add-port=80/tcp <span class="comment"># 启用80端口 TCP</span></span><br><span class="line">$ firewall-cmd --permanent --zone=public --add-port=443/tcp <span class="comment"># 启用443端口</span></span><br><span class="line"><span class="comment"># 重新载入配置</span></span><br><span class="line">$ firewall-cmd --reload</span><br><span class="line"><span class="comment"># 查看已经开放的端口或者服务</span></span><br><span class="line">$ firewall-cmd --list-all</span><br></pre></td></tr></table></figure><h2 id="尝试启动Nginx"><a href="#尝试启动Nginx" class="headerlink" title="尝试启动Nginx"></a>尝试启动Nginx</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pwd &gt; /usr/local/nginx 当前路径</span></span><br><span class="line">$ ./nginx <span class="comment"># 可以尝试访问树莓派IP</span></span><br><span class="line">$ ./nginx -s stop <span class="comment">#强制关闭Nginx 包括正在处理的请求</span></span><br><span class="line">$ ./nginx -s quit <span class="comment">#退出前完成已经接受的请求</span></span><br><span class="line">$ ./nginx -s reload <span class="comment">#平滑过渡 载入配置，使连接不中断</span></span><br></pre></td></tr></table></figure><h2 id="配置Nginx-service"><a href="#配置Nginx-service" class="headerlink" title="配置Nginx.service"></a>配置Nginx.service</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ vim /usr/lib/systemd/system/nginx.service</span><br><span class="line"><span class="comment"># 如何使用vim 请百度或者Google</span></span><br></pre></td></tr></table></figure><h3 id="写入以下内容"><a href="#写入以下内容" class="headerlink" title="写入以下内容"></a>写入以下内容</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=nginx</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/nginx/sbin/nginx</span><br><span class="line">ExecReload=/usr/local/nginx/sbin/nginx -s reload</span><br><span class="line">ExecStop=/usr/local/nginx/sbin/nginx -s quit</span><br><span class="line">PrivateTmp=true</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><h2 id="使用systemctl"><a href="#使用systemctl" class="headerlink" title="使用systemctl"></a>使用systemctl</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl start nginx <span class="comment"># 启动Nginx</span></span><br><span class="line">$ systemctl reload nginx <span class="comment"># 重新载入配置文件</span></span><br><span class="line">$ systemctl status nginx <span class="comment"># 查看当前运行状态</span></span><br><span class="line">$ systemctl <span class="built_in">enable</span> nginx <span class="comment"># 设置开机启动</span></span><br><span class="line">$ systemctl <span class="built_in">disable</span> nginx <span class="comment"># 设置开机不启动</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;主要记录&lt;strong&gt;armv7l&lt;/strong&gt;平台安装Nginx过程&lt;/p&gt;
&lt;h2 id=&quot;安装编译环境&quot;&gt;&lt;a href=&quot;#安装编译环境&quot; class=&quot;headerlink&quot; title=&quot;安装编译环境&quot;&gt;&lt;/a&gt;安装编译环境&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ yum install -y gcc-c++ pcre pcre-devel zliv zliv-devel zliv zliv-devel openssl openssl-devel wget&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="CentOS7" scheme="https://heyikang.me/tags/CentOS7/"/>
    
      <category term="树莓派3B" scheme="https://heyikang.me/tags/%E6%A0%91%E8%8E%93%E6%B4%BE3B/"/>
    
      <category term="Nginx" scheme="https://heyikang.me/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript Strict Model</title>
    <link href="https://heyikang.me/2018/03/07/javascript-strict-model/"/>
    <id>https://heyikang.me/2018/03/07/javascript-strict-model/</id>
    <published>2018-03-07T03:11:20.000Z</published>
    <updated>2018-10-11T11:13:45.618Z</updated>
    
    <content type="html"><![CDATA[<h2 id="使用严格模式的目的"><a href="#使用严格模式的目的" class="headerlink" title="使用严格模式的目的"></a>使用严格模式的目的</h2><ul><li>消除JavaScript语法的一些不合理、不严谨，减少怪异行为</li><li>消除代码运行的一些不安全之处，保证代码运行安全</li><li>提高编译器效率，增加运行速度</li><li>为未来新版本的JavaScript做好铺垫</li></ul><a id="more"></a><h2 id="使用严格模式"><a href="#使用严格模式" class="headerlink" title="使用严格模式"></a>使用严格模式</h2><ul><li>use strict</li></ul><p>如果浏览器<strong>不支持严格模式</strong>浏览器会把它当作普通字符串被<strong>忽略</strong></p><p>进入严格模式</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br></pre></td></tr></table></figure><h3 id="调用方式"><a href="#调用方式" class="headerlink" title="调用方式"></a>调用方式</h3><ul><li>针对整个脚本</li></ul><p>将<code>&quot;use strict&quot;</code>放在降本文件的第一行，则整个脚本都将以“严格模式”运行。如果这行语句不在第一行，则无效（仅针对整个脚本），整个脚本将以“正常模式”运行。如果不同模式的代码文件合并成一个文件，这一点需要特别注意。</p><blockquote><p>严格地说，只要前面不是产生实际运行结果的语句，<code>&quot;use strict&quot;</code>可以不用在第一行，比如直接跟在一个空的分好后面。</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="meta">    "use strict"</span>;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">'这是严格模式'</span>)</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">'这是正常模式'</span>)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>针对单个函数</li></ul><p>将<code>&quot;use strict&quot;</code>放在函数内的第一行，则整个函数以“严格模式”运行。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">strictModel</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'这是严格模式'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">notStrictModel</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'这是正常模式'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>脚本文件的变通写法<strong>(IIFE)</strong></li></ul><p>因为第一种调用方法不利于文件合并，所以更好的做法是，借用第二种方法，将整个脚本放在一个立即执行的匿名函数之中</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="meta">    "use strict"</span></span><br><span class="line">    <span class="comment">// Code</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><h2 id="语法和行为的改变"><a href="#语法和行为的改变" class="headerlink" title="语法和行为的改变"></a>语法和行为的改变</h2><p>严格模式对JavaScript的语法和行为，都做了一些改变</p><h3 id="全局变量显式声明"><a href="#全局变量显式声明" class="headerlink" title="全局变量显式声明"></a>全局变量显式声明</h3><p>在正常模式中，如果一个变量没有声明就赋值，默认是全局变量。严格模式禁止这种用法，全局变量必须显式声明。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line">num = <span class="number">1</span> <span class="comment">// ReferenceError: num is not defined</span></span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;&#125; <span class="comment">// ReferenceError: i is not defined</span></span><br></pre></td></tr></table></figure><h3 id="静态绑定"><a href="#静态绑定" class="headerlink" title="静态绑定"></a>静态绑定</h3><p>JavaScript语言的一个特点，就是允许<strong>“动态绑定”</strong>，即某些属性和方法到底属于哪一个对象，不适在编译时确定的，而是在运行时<strong>(runtime)</strong>确定的。</p><p>严格模式对动态绑定做了一些限制。某些情况下，只允许静态绑定。也就是说，属性和方法到底归属哪个对象，在编译阶段就确定。这样做有利于编译效率的提高，也使得代码更容易阅读，更少出现意外</p><p>具体来说，涉及一下几个方面。</p><ul><li>禁止使用<code>with</code>语句</li></ul><p>因为使用<code>with</code>语句就无法在编译时就确定，属性到底归属哪个对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"><span class="keyword">var</span> el = <span class="built_in">document</span>.getElementById(<span class="string">'el'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span>(el.style)&#123; <span class="comment">// SyntaxError: Strict mode code may not include a with statement</span></span><br><span class="line">    margin = <span class="string">'auto'</span></span><br><span class="line">    padding = <span class="string">'none'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>建立<code>eval</code>作用域</li></ul><p>正常模式下，JavaScript语言有三种作用域(scope)，全局作用域、函数作用域、块级作用域。严格模式下建立了第三种作用域：eval作用域</p><p>正常模式下，eval语句的作用域，取决于它处于全局作用域，还是处于函数作用域。严格模式下，eval语句本身就是一个作用域，不再能够生成全局变量了，它所生成的变量只能用于eval内部。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 严格模式</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span></span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">2</span></span><br><span class="line">    <span class="built_in">console</span>.info(<span class="built_in">eval</span>(<span class="string">'var x = 5;x'</span>)) <span class="comment">// 输出：5</span></span><br><span class="line">    <span class="built_in">console</span>.info(x) <span class="comment">// 输出：2</span></span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正常模式</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> y = <span class="number">8</span></span><br><span class="line">    <span class="built_in">console</span>.info(<span class="built_in">eval</span>(<span class="string">'var y = 5;y'</span>)) <span class="comment">//输出：5</span></span><br><span class="line">    <span class="built_in">console</span>.info(y) <span class="comment">// 输出：5</span></span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure><h3 id="增强的安全措施"><a href="#增强的安全措施" class="headerlink" title="增强的安全措施"></a>增强的安全措施</h3><ul><li>禁止<code>this</code>关键字指向全局对象</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 正常模式</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">notStrictModel</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>) </span><br><span class="line">    <span class="comment">// Chrome 输出 Window 对象</span></span><br><span class="line">    <span class="comment">// Node.js输出 global 对象</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 严格模式</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">strictModel</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">    <span class="comment">// Chrome 输出 undefined</span></span><br><span class="line">    <span class="comment">// Node.js输出 undefined</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因此使用构造函数时，如果忘记加<code>new</code>，<code>this</code>不在指向全局对象而是报错。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span></span><br><span class="line">    <span class="keyword">this</span>.a = num</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a)</span><br><span class="line">&#125;</span><br><span class="line">fn1(<span class="number">100</span>) <span class="comment">// TypeError: Cannot set property 'a' of undefined</span></span><br><span class="line"><span class="comment">// 使用 new 关键字</span></span><br><span class="line"><span class="keyword">new</span> fn1(<span class="number">100</span>) <span class="comment">// 输出：100</span></span><br></pre></td></tr></table></figure><ul><li>禁止在函数内部遍历调用栈</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">strictModel</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span></span><br><span class="line">    <span class="built_in">console</span>.log(strictModel.caller) <span class="comment">//返回一个对函数的引用</span></span><br><span class="line">    <span class="built_in">console</span>.log(strictModel.arguments) <span class="comment">//返回一个对象并不是数组</span></span><br><span class="line">    <span class="built_in">console</span>.log(strictModel.arguments.cllee)<span class="comment">// 返回当前函数名</span></span><br><span class="line">&#125;</span><br><span class="line">strictModel();</span><br><span class="line"><span class="comment">// TypeError: 'caller', 'callee', and 'arguments' properties may not be accessed on strict mode functions or the arguments objects for calls to them</span></span><br></pre></td></tr></table></figure><ul><li>禁止删除变量</li></ul><p>严格模式下无法删除变量。只有<code>configurable</code>设置为<code>true</code>的对象属性才能被删除</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"><span class="keyword">var</span> x</span><br><span class="line"><span class="keyword">delete</span> x;</span><br><span class="line"><span class="comment">// SyntaxError: Delete of an unqualified identifier in strict mode.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> o = <span class="built_in">Object</span>.create(<span class="literal">null</span>,&#123;<span class="string">'x'</span>:&#123;</span><br><span class="line">    value:<span class="number">1</span>,</span><br><span class="line">    configurable:<span class="literal">true</span></span><br><span class="line">&#125;&#125;)</span><br><span class="line"><span class="keyword">var</span> state = <span class="keyword">delete</span> o.x</span><br><span class="line"><span class="built_in">console</span>.log(state) <span class="comment">// true 删除成功</span></span><br></pre></td></tr></table></figure><ul><li>显式报错</li></ul><p>正常模式下，对一个对象的<strong>只读属性执行赋值</strong>，<strong>不会报错</strong>，只会默默地失败。严格模式下，将会报错。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"><span class="keyword">var</span> o = &#123;&#125;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(o, <span class="string">'v'</span>, &#123;</span><br><span class="line">    value: <span class="number">1</span>,</span><br><span class="line">    writable: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line">o.v = <span class="number">2</span></span><br><span class="line"><span class="comment">// TypeError: Cannot assign to read only property 'v' of object '#&lt;Object&gt;'</span></span><br></pre></td></tr></table></figure><p>严格模式下，对一个使用getter方法读取的属性就行赋值，会报错</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"><span class="keyword">var</span> o = &#123;</span><br><span class="line">    get value()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">o.value = <span class="number">2</span></span><br><span class="line"><span class="comment">// TypeError: Cannot set property value of #&lt;Object&gt; which has only a getter</span></span><br></pre></td></tr></table></figure><p>严格模式下，对禁止扩展的对象添加新属性，将会报错。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"><span class="keyword">var</span> o = &#123;&#125;</span><br><span class="line"><span class="built_in">Object</span>.preventExtensions(o)</span><br><span class="line">o.v = <span class="number">1</span> </span><br><span class="line"><span class="comment">// TypeError: Cannot add property v, object is not extensible</span></span><br></pre></td></tr></table></figure><p>严格模式下，删除一个不可删除的属性，将会报错。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"><span class="keyword">delete</span> <span class="built_in">Object</span>.prototype</span><br><span class="line"><span class="comment">// TypeError: Cannot delete property 'prototype' of function Object() &#123; [native code] &#125;</span></span><br></pre></td></tr></table></figure><h3 id="重名错误"><a href="#重名错误" class="headerlink" title="重名错误"></a>重名错误</h3><p>严格模式新增了一些语法错误。</p><ul><li>函数不能有重名的参数</li></ul><p>正常模式下，如果函数有多个重名的参数，可以使用aruments[index]读取。严格模式下，这属于语法错误</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">a,a,a,b</span>)</span>&#123;&#125;</span><br><span class="line"><span class="comment">// SyntaxError: Duplicate parameter name not allowed in this context</span></span><br></pre></td></tr></table></figure><h3 id="禁止八进制表示法"><a href="#禁止八进制表示法" class="headerlink" title="禁止八进制表示法"></a>禁止八进制表示法</h3><p>正常模式下，证书的第一位如果是0，表示这个是八进制数，如果0100等于十进制64。严格模式禁止这种表示法，整数第一位为0，将报错。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"><span class="keyword">var</span> num = <span class="number">0100</span></span><br><span class="line"><span class="comment">// SyntaxError: Octal literals are not allowed in strict mode.</span></span><br></pre></td></tr></table></figure><h3 id="arguments对象限制"><a href="#arguments对象限制" class="headerlink" title="arguments对象限制"></a><code>arguments</code>对象限制</h3><p><code>arguments</code>是函数的参数对象，严格模式对它的使用做了限制。</p><ul><li>不允许对<code>arguments</code>赋值</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"><span class="built_in">arguments</span>++</span><br><span class="line"><span class="comment">// SyntaxError: Unexpected eval or arguments in strict mode</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123; set p(<span class="built_in">arguments</span>) &#123; &#125; &#125;;</span><br><span class="line"><span class="comment">// SyntaxError: Unexpected eval or arguments in strict mode</span></span><br><span class="line"><span class="keyword">try</span> &#123; &#125; <span class="keyword">catch</span> (<span class="built_in">arguments</span>) &#123; &#125; </span><br><span class="line"><span class="comment">// SyntaxError: Unexpected eval or arguments in strict mode</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">arguments</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line"><span class="comment">// SyntaxError: Unexpected eval or arguments in strict mode</span></span><br><span class="line"><span class="keyword">var</span> f = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">"arguments"</span>, <span class="string">"'use strict'; return 17;"</span>)</span><br><span class="line"><span class="comment">// SyntaxError: Unexpected eval or arguments in strict mode</span></span><br></pre></td></tr></table></figure><ul><li><code>arguments</code>不再追踪参数的变化</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 正常模式</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">notStrictModel</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line">    num = <span class="number">2</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">arguments</span>[<span class="number">0</span>]) <span class="comment">//正常模式下 arguments 会被修改 输出：2</span></span><br><span class="line">&#125;</span><br><span class="line">notStrictModel(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">strictModel</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span></span><br><span class="line">    num = <span class="number">2</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">arguments</span>[<span class="number">0</span>]) <span class="comment">//严格模式下 arguments 不会被修改 输出：10</span></span><br><span class="line">&#125;</span><br><span class="line">strictModel(<span class="number">10</span>)</span><br></pre></td></tr></table></figure><ul><li>禁止使用<code>arguments.callee</code></li></ul><p>这就意味着，无法在匿名函数内部调用自身了。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">arguments</span>.callee</span><br><span class="line">&#125;</span><br><span class="line">f() <span class="comment">// TypeError: 'caller', 'callee', and 'arguments' properties may not be accessed on strict mode functions or the arguments objects for calls to them</span></span><br></pre></td></tr></table></figure><h3 id="保留字"><a href="#保留字" class="headerlink" title="保留字"></a>保留字</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">implements interface let const async await</span><br><span class="line">package private public static yield class</span><br><span class="line">enum exports extends super</span><br></pre></td></tr></table></figure><p>使用这些词作为变量名将会报错。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">package</span>(<span class="params">await</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">static</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// SyntaxError: Unexpected strict mode reserved word</span></span><br></pre></td></tr></table></figure><h2 id="参考连接"><a href="#参考连接" class="headerlink" title="参考连接"></a>参考连接</h2><ul><li>MSDN<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Strict_mode" target="_blank" rel="noopener">Strict_mode</a></li><li>阮一峰的<a href="http://www.ruanyifeng.com/blog/2013/01/javascript_strict_mode.html" target="_blank" rel="noopener">Javascript 严格模式</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;使用严格模式的目的&quot;&gt;&lt;a href=&quot;#使用严格模式的目的&quot; class=&quot;headerlink&quot; title=&quot;使用严格模式的目的&quot;&gt;&lt;/a&gt;使用严格模式的目的&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;消除JavaScript语法的一些不合理、不严谨，减少怪异行为&lt;/li&gt;
&lt;li&gt;消除代码运行的一些不安全之处，保证代码运行安全&lt;/li&gt;
&lt;li&gt;提高编译器效率，增加运行速度&lt;/li&gt;
&lt;li&gt;为未来新版本的JavaScript做好铺垫&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="JavaScript" scheme="https://heyikang.me/tags/JavaScript/"/>
    
      <category term="学习笔记" scheme="https://heyikang.me/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>树莓派3B 安装Node.js</title>
    <link href="https://heyikang.me/2018/01/23/%E6%A0%91%E8%8E%93%E6%B4%BE3B-%E5%AE%89%E8%A3%85Node-js/"/>
    <id>https://heyikang.me/2018/01/23/树莓派3B-安装Node-js/</id>
    <published>2018-01-23T00:37:38.000Z</published>
    <updated>2018-10-11T11:13:45.621Z</updated>
    
    <content type="html"><![CDATA[<p>主要记录<strong>armv7l</strong>平台安装Node.js过程</p><p><strong>Linux</strong>可以通过<code>uname -a</code>查看平台信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://nodejs.org/dist/v8.9.4/node-v8.9.4-linux-armv7l.tar.xz <span class="comment"># 下载源码包</span></span><br><span class="line">$ xz -d node-v8.9.4-linux-armv7l.tar.xz <span class="comment"># xz 解压</span></span><br><span class="line">$ tar vxf node-v8.9.4-linux-armv7l.tar  <span class="comment"># tar 解压</span></span><br><span class="line">$ mv node-v8.9.4-linux-armv7l /usr/<span class="built_in">local</span>/node.js <span class="comment"># 移动并重命名</span></span><br><span class="line">$ <span class="built_in">echo</span> PATH=<span class="variable">$PATH</span>:/usr/<span class="built_in">local</span>/node.js/bin &gt;&gt; ~/.bashrc <span class="comment"># 添加路径信息到环境变量</span></span><br><span class="line">$ <span class="built_in">source</span> ~/.bashrc <span class="comment"># 立即生效</span></span><br><span class="line">$ rm -rf ~/node-v8.9.4-linux-armv7l.tar <span class="comment"># 删除源码包</span></span><br><span class="line">$ node -v <span class="comment">#查看 Node.js 版本</span></span><br><span class="line">$ npm -v  <span class="comment">#查看 npm 版本</span></span><br><span class="line">$ npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org/ <span class="comment"># 修改淘宝NPM镜像</span></span><br><span class="line">$ npm config get registry <span class="comment"># 检查是否设置成功</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;主要记录&lt;strong&gt;armv7l&lt;/strong&gt;平台安装Node.js过程&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Linux&lt;/strong&gt;可以通过&lt;code&gt;uname -a&lt;/code&gt;查看平台信息&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;
      
    
    </summary>
    
    
      <category term="node.js" scheme="https://heyikang.me/tags/node-js/"/>
    
      <category term="CentOS7" scheme="https://heyikang.me/tags/CentOS7/"/>
    
      <category term="树莓派3B" scheme="https://heyikang.me/tags/%E6%A0%91%E8%8E%93%E6%B4%BE3B/"/>
    
  </entry>
  
  <entry>
    <title>我的第一个爬虫</title>
    <link href="https://heyikang.me/2018/01/06/MyFirstWebCrawler/"/>
    <id>https://heyikang.me/2018/01/06/MyFirstWebCrawler/</id>
    <published>2018-01-06T07:16:31.000Z</published>
    <updated>2018-10-11T11:13:45.616Z</updated>
    
    <content type="html"><![CDATA[<p>年前帮朋友装个系统，朋友要安装Windows8，我去MSDN下载,那速度惨不忍睹，果断开个迅雷会员。</p><p>心想只下这么点资源岂不是浪费了？然后就有了我的第一个爬虫。</p><h2 id="页面分析"><a href="#页面分析" class="headerlink" title="页面分析"></a>页面分析</h2><a id="more"></a><ul><li>页面地址 <a href="https://msdn.itellyou.cn/" target="_blank" rel="noopener">https://msdn.itellyou.cn/</a></li><li>浏览器 <a href="http://www.google.cn/chrome/browser/desktop/" target="_blank" rel="noopener">Google Chrome</a></li><li>测试请求工具 桌面端：<a href="https://www.getpostman.com/" target="_blank" rel="noopener">PostMan</a> 也可以进如Chrome商店获取浏览器端。</li></ul><p><img src="/images/MyFirstWebCrawler/demo.jpg" alt="menu list"></p><blockquote><p>一级列表红框内</p></blockquote><p>当点击红框内的文字时，会出发AJAX请求。</p><ul><li>请求地址 <a href="https://msdn.itellyou.cn/Category/Index" target="_blank" rel="noopener">https://msdn.itellyou.cn/Category/Index</a></li><li>请求类型 POST</li><li>请求格式 Form Data id=[列表ID]</li><li>返回以下数据</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="string">"379a811e-1ef3-4d37-952e-2baf4df9e4b3"</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"AutoCollage 2008"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="string">"bcac9258-b652-4c1a-a828-a4fe23cc47cb"</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"Expression 1"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="string">"8a451b0a-b0ee-49ed-afc4-a7dc28599dd8"</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"Expression 2"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="string">"0f75c79d-fb44-40cf-a627-52c0519b9cd0"</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"Expression 3"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="string">"d5325dd4-a557-4c35-b855-3d9ac72b55a9"</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"Expression 4"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="string">"81635ff2-60e9-448e-aa8d-7e62bd20e029"</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"Songsmith"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><blockquote><p>二级列表绿框内</p></blockquote><p>当点击黑色文字的时候又会触发AJAX请求。</p><ul><li>请求地址 <a href="https://msdn.itellyou.cn/Category/GetLang" target="_blank" rel="noopener">https://msdn.itellyou.cn/Category/GetLang</a></li><li>请求类型 POST</li><li>请求格式 Form Data id=[列表ID]</li><li>返回以下数据</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"status"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"result"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"id"</span>: <span class="string">"c5fe5be2-1c54-49a0-80fb-bfab286484eb"</span>,</span><br><span class="line">                <span class="attr">"lang"</span>: <span class="string">"多国语言"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"id"</span>: <span class="string">"e15db4de-c094-4c50-822a-98ad50daba4f"</span>,</span><br><span class="line">                <span class="attr">"lang"</span>: <span class="string">"英语"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"id"</span>: <span class="string">"041dbbd2-c198-4523-b438-590128265d82"</span>,</span><br><span class="line">                <span class="attr">"lang"</span>: <span class="string">"中文 - 简体"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"id"</span>: <span class="string">"0c3d9de8-73e4-401b-b9b5-562fba62993d"</span>,</span><br><span class="line">                <span class="attr">"lang"</span>: <span class="string">"中文 - 香港"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"id"</span>: <span class="string">"ae1d1974-ce57-4957-9d20-172bd2b34fd0"</span>,</span><br><span class="line">                <span class="attr">"lang"</span>: <span class="string">"中文 - 繁体"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"id"</span>: <span class="string">"b6515fef-2a56-4bf3-af51-06cd8d4e5557"</span>,</span><br><span class="line">                <span class="attr">"lang"</span>: <span class="string">"韩语"</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>三级语言列表 </p></blockquote><ul><li>请求地址 <a href="https://msdn.itellyou.cn/Category/GetList" target="_blank" rel="noopener">https://msdn.itellyou.cn/Category/GetList</a></li><li>请求类型 POST</li><li>请求格式 Form Data 相比之前请求多了 lang,filter 键</li><li>返回以下数据</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"status"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"result"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="string">"e953d299-3667-4153-a081-afc8f26ebead"</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"Windows 10 Language Pack (x64) - DVD (Multiple Languages)"</span>,</span><br><span class="line">            <span class="attr">"post"</span>: <span class="string">"/Date(1438113330377)/"</span>,</span><br><span class="line">            <span class="attr">"url"</span>: <span class="string">"ed2k://|file|mu_windows_10_language_pack_x64_dvd_6846438.iso|1370247168|ED038183115D03F8627F22593425F246|/"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="string">"f1345f3d-86de-4094-9298-0f54f0132e38"</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"Windows 10 Language Pack (x86) - DVD (Multiple Languages)"</span>,</span><br><span class="line">            <span class="attr">"post"</span>: <span class="string">"/Date(1438113330377)/"</span>,</span><br><span class="line">            <span class="attr">"url"</span>: <span class="string">"ed2k://|file|mu_windows_10_language_pack_x86_dvd_6846439.iso|963231744|D6EF0A816846D3758B0D23894DA84159|/"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>四级获取文件详细信息</p></blockquote><ul><li>请求地址 <a href="https://msdn.itellyou.cn/Category/GetProduct" target="_blank" rel="noopener">https://msdn.itellyou.cn/Category/GetProduct</a></li><li>请求类型 POST</li><li>请求格式 Form Data id=[文件ID]</li><li>返回以下数据</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"status"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"result"</span>: &#123;</span><br><span class="line">        <span class="attr">"FileName"</span>: <span class="string">"en_windows_10_multiple_editions_x64_dvd_6846432.iso"</span>,</span><br><span class="line">        <span class="attr">"DownLoad"</span>: <span class="string">"ed2k://|file|en_windows_10_multiple_editions_x64_dvd_6846432.iso|4083853312|E59F65B0C508FB1C1FAE337EDF83058E|/"</span>,</span><br><span class="line">        <span class="attr">"PostDateString"</span>: <span class="string">"2015-07-29"</span>,</span><br><span class="line">        <span class="attr">"SHA1"</span>: <span class="string">"60CCE9E9C6557335B4F7B18D02CFE2B438A8B3E2"</span>,</span><br><span class="line">        <span class="attr">"size"</span>: <span class="string">"3.8GB"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>其实爬并不难，因为除了首页需要GET到之后进行分析，其它的数据都可以通过数据接口的方式进行获取。</p><ul><li>使用<a href="https://github.com/request/request" target="_blank" rel="noopener">request</a>进行请求</li><li>使用<a href="https://github.com/cheeriojs/cheerio" target="_blank" rel="noopener">cheerio</a>分析首页相关数据</li><li>使用<a href="https://github.com/request/request-promise" target="_blank" rel="noopener">request-promise</a>Premise封装过的request</li><li>使用<em>ES7</em> 的 <code>async/await</code> 把异步代码变成同步，以免造成<a href="http://callbackhell.com/" target="_blank" rel="noopener">回调噩梦</a></li></ul><h2 id="创作"><a href="#创作" class="headerlink" title="创作"></a>创作</h2><p>创建文件夹进如文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm init  <span class="comment"># 生成Package.json 文件</span></span><br><span class="line">npm install --save request request-promise cheerio <span class="comment"># 安装插件</span></span><br><span class="line">mkdir lib   <span class="comment"># 创建 lib 目录</span></span><br></pre></td></tr></table></figure><p>我们现在lib目录下创建一个get.js 用于网络请求</p><blockquote><p>URL 请求</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> rp = <span class="built_in">require</span>(<span class="string">'request-promise'</span>)</span><br><span class="line">, cheerio = <span class="built_in">require</span>(<span class="string">'cheerio'</span>)</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">url</span>(<span class="params">method, uri, form</span>) </span>&#123;  <span class="comment">// URL 请求的唯一方法 所有的请求都需要这个方法来完成并返回数据</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> opstions = &#123;                  </span><br><span class="line">        method,</span><br><span class="line">        uri,</span><br><span class="line">        headers: &#123;</span><br><span class="line">            <span class="string">'referer'</span>: <span class="string">'https://msdn.itellyou.cn/'</span> <span class="comment">// 因为网站采用HTTPS 所以需要在请求头中加入Referer</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (form) &#123;</span><br><span class="line">        opstions.form = form</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rp(opstions)    <span class="comment">// 返回Promise 实例</span></span><br><span class="line">        .then(<span class="function"><span class="params">body</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> body   <span class="comment">// 返回请求内容</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> err   <span class="comment">// 返回错误</span></span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>首页获取</p></blockquote><p><code>async</code> 用于声明这是一个异步函数，需要等待 <code>await</code> 返回才会继续执行</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">topMenu</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> url(<span class="string">'GET'</span>, <span class="string">'https://msdn.itellyou.cn/'</span>)</span><br><span class="line">    <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`error：<span class="subst">$&#123;data.error&#125;</span>`</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> $ = cheerio.load(data)   <span class="comment">// 将获取到的数据载入到 cheerio  语法类似于jQiery 只是类似！ </span></span><br><span class="line">        , $item = $(<span class="string">'#accordion &gt; .panel-primary'</span>)   <span class="comment">// 获取一级Menu</span></span><br><span class="line">        , $len = $item.length            </span><br><span class="line">        , menuInfo = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; $len; i++) &#123;             <span class="comment">// 进行遍历</span></span><br><span class="line">        menuInfo.push(&#123;</span><br><span class="line">            name: $(<span class="string">'#accordion &gt; .panel-primary a'</span>).eq(i).text(),  <span class="comment">//获取Menu 标题</span></span><br><span class="line">            id: $(<span class="string">'#accordion &gt; .panel-primary a'</span>).eq(i).attr(<span class="string">'data-menuid'</span>)  <span class="comment">// 获取 menuid 请求的时候回用到</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> menuInfo   <span class="comment">// 返回数据</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>二级菜单获取</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">twoMenu</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> topMenu()  <span class="comment">// 等待上个函数返回结果</span></span><br><span class="line">        , len = data.length</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">                                        <span class="comment">// 传入ID</span></span><br><span class="line">        <span class="keyword">let</span> twoData = <span class="keyword">await</span> url(<span class="string">'POST'</span>, <span class="string">'https://msdn.itellyou.cn/Category/Index'</span>, &#123; <span class="attr">id</span>: data[i].id &#125;); </span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (twoData.error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`error：<span class="subst">$&#123;data.error&#125;</span>`</span>)  </span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`正在获取：<span class="subst">$&#123;data[i].name&#125;</span> 列表`</span>)</span><br><span class="line"></span><br><span class="line">        data[i].data = <span class="built_in">JSON</span>.parse(twoData)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>完整项目移步<a href="https://github.com/heyikang/msdn-download" target="_blank" rel="noopener">Github</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;年前帮朋友装个系统，朋友要安装Windows8，我去MSDN下载,那速度惨不忍睹，果断开个迅雷会员。&lt;/p&gt;
&lt;p&gt;心想只下这么点资源岂不是浪费了？然后就有了我的第一个爬虫。&lt;/p&gt;
&lt;h2 id=&quot;页面分析&quot;&gt;&lt;a href=&quot;#页面分析&quot; class=&quot;headerlink&quot; title=&quot;页面分析&quot;&gt;&lt;/a&gt;页面分析&lt;/h2&gt;
    
    </summary>
    
    
      <category term="node.js" scheme="https://heyikang.me/tags/node-js/"/>
    
      <category term="JavaScript" scheme="https://heyikang.me/tags/JavaScript/"/>
    
      <category term="爬虫" scheme="https://heyikang.me/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>Windows GVLK</title>
    <link href="https://heyikang.me/2017/12/30/Windows-GVLK/"/>
    <id>https://heyikang.me/2017/12/30/Windows-GVLK/</id>
    <published>2017-12-29T21:49:34.000Z</published>
    <updated>2018-10-11T11:13:45.617Z</updated>
    
    <content type="html"><![CDATA[<p>每次装完系统都挺烦的。这次更烦！好多资料都丢了，激活还是个问题。</p><h2 id="KMS-Key-Management-Service"><a href="#KMS-Key-Management-Service" class="headerlink" title="KMS(Key Management Service)"></a>KMS(Key Management Service)</h2><ul><li>Windows</li></ul><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// INSTALL</span><br><span class="line">slmgr /ipk W269N-WFGWX-YVC9B-<span class="number">4</span>J6C9-T83GX //GVKL</span><br><span class="line">slmgr /skms domain.com //指定你自己的 Management Service ipaddress or domain</span><br><span class="line">slmgr /ato //执行操作</span><br><span class="line">// UNINSTALL</span><br><span class="line">slmgr /upk //卸载KEY</span><br><span class="line">slmgr /ckms //清除IP地址</span><br><span class="line">slmgr /rearm //重置授权状态</span><br><span class="line">shutdown -r -t <span class="number">0</span> //重启</span><br></pre></td></tr></table></figure><a id="more"></a><ul><li>Office</li></ul><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//INSTALL</span><br><span class="line"><span class="built_in">cd</span> "C:\Program Files\Microsoft Office\Office16"</span><br><span class="line">cscript ospp.vbs /sethst:domain.com</span><br><span class="line">cscript ospp.vbs /act</span><br></pre></td></tr></table></figure><h2 id="GVLK"><a href="#GVLK" class="headerlink" title="GVLK"></a>GVLK</h2><table><thead><tr><th style="text-align:left">OS</th><th style="text-align:left">GVLK</th></tr></thead><tbody><tr><td style="text-align:left">Windows 10 Professional</td><td style="text-align:left">W269N-WFGWX-YVC9B-4J6C9-T83GX</td></tr><tr><td style="text-align:left">Windows 10 Professional N</td><td style="text-align:left">MH37W-N47XK-V7XM9-C7227-GCQG9</td></tr><tr><td style="text-align:left">Windows 10 Enterprise</td><td style="text-align:left">NPPR9-FWDCX-D2C8J-H872K-2YT43</td></tr><tr><td style="text-align:left">Windows 10 Enterprise N</td><td style="text-align:left">DPH2V-TTNVB-4X9Q3-TJR4H-KHJW4</td></tr><tr><td style="text-align:left">Windows 10 Education</td><td style="text-align:left">NW6C2-QMPVW-D7KKK-3GKT6-VCFB2</td></tr><tr><td style="text-align:left">Windows 10 Education N</td><td style="text-align:left">2WH4N-8QGBV-H22JP-CT43Q-MDWWJ</td></tr><tr><td style="text-align:left">Windows 10 Enterprise 2015 LTSB</td><td style="text-align:left">WNMTR-4C88C-JK8YV-HQ7T2-76DF9</td></tr><tr><td style="text-align:left">Windows 10 Enterprise 2015 LTSB N</td><td style="text-align:left">2F77B-TNFGY-69QQF-B8YKP-D69TJ</td></tr><tr><td style="text-align:left">Windows 10 Enterprise 2016 LTSB</td><td style="text-align:left">DCPHK-NFMTC-H88MJ-PFHPY-QJ4BJ</td></tr><tr><td style="text-align:left">Windows 10 Enterprise 2016 LTSB N</td><td style="text-align:left">QFFDN-GRT3P-VKWWX-X7T3R-8B639</td></tr><tr><td style="text-align:left">Windows Server 2016 Datacenter</td><td style="text-align:left">CB7KF-BWN84-R7R2Y-793K2-8XDDG</td></tr><tr><td style="text-align:left">Windows Server 2016 Standard</td><td style="text-align:left">WC2BQ-8NRM3-FDDYY-2BFGV-KHKQY</td></tr><tr><td style="text-align:left">Windows Server 2016 Essentials</td><td style="text-align:left">JCKRF-N37P4-C2D82-9YXRT-4M63B</td></tr><tr><td style="text-align:left">Windows 8.1 Professional</td><td style="text-align:left">GCRJD-8NW9H-F2CDX-CCM8D-9D6T9</td></tr><tr><td style="text-align:left">Windows 8.1 Professional N</td><td style="text-align:left">HMCNV-VVBFX-7HMBH-CTY9B-B4FXY</td></tr><tr><td style="text-align:left">Windows 8.1 Enterprise</td><td style="text-align:left">MHF9N-XY6XB-WVXMC-BTDCT-MKKG7</td></tr><tr><td style="text-align:left">Windows 8.1 Enterprise N</td><td style="text-align:left">TT4HM-HN7YT-62K67-RGRQJ-JFFXW</td></tr><tr><td style="text-align:left">Windows Server 2012 R2 Server Standard</td><td style="text-align:left">D2N9P-3P6X9-2R39C-7RTCD-MDVJX</td></tr><tr><td style="text-align:left">Windows Server 2012 R2 Datacenter</td><td style="text-align:left">W3GGN-FT8W3-Y4M27-J84CP-Q3VJ9</td></tr><tr><td style="text-align:left">Windows Server 2012 R2 Essentials</td><td style="text-align:left">KNC87-3J2TX-XB4WP-VCPJV-M4FWM</td></tr><tr><td style="text-align:left">Windows 8 Professional</td><td style="text-align:left">NG4HW-VH26C-733KW-K6F98-J8CK4</td></tr><tr><td style="text-align:left">Windows 8 Professional N</td><td style="text-align:left">XCVCF-2NXM9-723PB-MHCB7-2RYQQ</td></tr><tr><td style="text-align:left">Windows 8 Enterprise</td><td style="text-align:left">32JNW-9KQ84-P47T8-D8GGY-CWCK7</td></tr><tr><td style="text-align:left">Windows 8 Enterprise N</td><td style="text-align:left">JMNMF-RHW7P-DMY6X-RF3DR-X2BQT</td></tr><tr><td style="text-align:left">Windows Server 2012</td><td style="text-align:left">BN3D2-R7TKB-3YPBD-8DRP2-27GG4</td></tr><tr><td style="text-align:left">Windows Server 2012 N</td><td style="text-align:left">8N2M2-HWPGY-7PGT9-HGDD8-GVGGY</td></tr><tr><td style="text-align:left">Windows Server 2012 Single Language</td><td style="text-align:left">2WN2H-YGCQR-KFX6K-CD6TF-84YXQ</td></tr><tr><td style="text-align:left">Windows Server 2012 Country Specific</td><td style="text-align:left">4K36P-JN4VD-GDC6V-KDT89-DYFKP</td></tr><tr><td style="text-align:left">Windows Server 2012 Server Standard</td><td style="text-align:left">XC9B7-NBPP2-83J2H-RHMBY-92BT4</td></tr><tr><td style="text-align:left">Windows Server 2012 MultiPoint Standard</td><td style="text-align:left">HM7DN-YVMH3-46JC3-XYTG7-CYQJJ</td></tr><tr><td style="text-align:left">Windows Server 2012 MultiPoint Premium</td><td style="text-align:left">XNH6W-2V9GX-RGJ4K-Y8X6F-QGJ2G</td></tr><tr><td style="text-align:left">Windows Server 2012 Datacenter</td><td style="text-align:left">48HP8-DN98B-MYWDG-T2DCC-8W83P</td></tr><tr><td style="text-align:left">Windows 7 Professional</td><td style="text-align:left">FJ82H-XT6CR-J8D7P-XQJJ2-GPDD4</td></tr><tr><td style="text-align:left">Windows 7 Professional N</td><td style="text-align:left">MRPKT-YTG23-K7D7T-X2JMM-QY7MG</td></tr><tr><td style="text-align:left">Windows 7 Professional E</td><td style="text-align:left">W82YF-2Q76Y-63HXB-FGJG9-GF7QX</td></tr><tr><td style="text-align:left">Windows 7 Enterprise</td><td style="text-align:left">33PXH-7Y6KF-2VJC9-XBBR8-HVTHH</td></tr><tr><td style="text-align:left">Windows 7 Enterprise N</td><td style="text-align:left">YDRBP-3D83W-TY26F-D46B2-XCKRJ</td></tr><tr><td style="text-align:left">Windows 7 Enterprise E</td><td style="text-align:left">C29WB-22CC8-VJ326-GHFJW-H9DH4</td></tr><tr><td style="text-align:left">Windows Server 2008 R2 Web</td><td style="text-align:left">6TPJF-RBVHG-WBW2R-86QPH-6RTM4</td></tr><tr><td style="text-align:left">Windows Server 2008 R2 HPC edition</td><td style="text-align:left">TT8MH-CG224-D3D7Q-498W2-9QCTX</td></tr><tr><td style="text-align:left">Windows Server 2008 R2 Standard</td><td style="text-align:left">YC6KT-GKW9T-YTKYR-T4X34-R7VHC</td></tr><tr><td style="text-align:left">Windows Server 2008 R2 Enterprise</td><td style="text-align:left">489J6-VHDMP-X63PK-3K798-CPX3Y</td></tr><tr><td style="text-align:left">Windows Server 2008 R2 Datacenter</td><td style="text-align:left">74YFP-3QFB3-KQT8W-PMXWJ-7M648</td></tr><tr><td style="text-align:left">Windows Server 2008 R2 for Itanium-based Systems</td><td style="text-align:left">GT63C-RJFQ3-4GMB6-BRFB9-CB83V</td></tr><tr><td style="text-align:left">Windows Vista Business</td><td style="text-align:left">6TPJF-RBVHG-WBW2R-86QPH-6RTM4</td></tr><tr><td style="text-align:left">Windows Vista Business N</td><td style="text-align:left">HMBQG-8H2RH-C77VX-27R82-VMQBT</td></tr><tr><td style="text-align:left">Windows Vista Enterprise</td><td style="text-align:left">VKK3X-68KWM-X2YGT-QR4M6-4BWMV</td></tr><tr><td style="text-align:left">Windows Vista Enterprise N</td><td style="text-align:left">VTC42-BM838-43QHV-84HX6-XJXKV</td></tr><tr><td style="text-align:left">Windows Web Server 2008</td><td style="text-align:left">WYR28-R7TFJ-3X2YQ-YCY4H-M249D</td></tr><tr><td style="text-align:left">Windows Server 2008 Standard</td><td style="text-align:left">TM24T-X9RMF-VWXK6-X8JC9-BFGM2</td></tr><tr><td style="text-align:left">Windows Server 2008 Standard without Hyper-V</td><td style="text-align:left">W7VD6-7JFBR-RX26B-YKQ3Y-6FFFJ</td></tr><tr><td style="text-align:left">Windows Server 2008 Enterprise</td><td style="text-align:left">YQGMW-MPWTJ-34KDK-48M3W-X4Q6V</td></tr><tr><td style="text-align:left">Windows Server 2008 Enterprise without Hyper-V</td><td style="text-align:left">39BXF-X8Q23-P2WWT-38T2F-G3FPG</td></tr><tr><td style="text-align:left">Windows Server 2008 HPC</td><td style="text-align:left">RCTX3-KWVHP-BR6TB-RB6DM-6X7HP</td></tr><tr><td style="text-align:left">Windows Server 2008 Datacenter</td><td style="text-align:left">7M67G-PC374-GR742-YH8V4-TCBY3</td></tr><tr><td style="text-align:left">Windows Server 2008 Datacenter without Hyper-V</td><td style="text-align:left">22XQ2-VRXRG-P8D42-K34TD-G3QQC</td></tr><tr><td style="text-align:left">Windows Server 2008 for Itanium-Based Systems</td><td style="text-align:left">4DWFP-JF3DJ-B7DTH-78FJB-PDRHK</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;每次装完系统都挺烦的。这次更烦！好多资料都丢了，激活还是个问题。&lt;/p&gt;
&lt;h2 id=&quot;KMS-Key-Management-Service&quot;&gt;&lt;a href=&quot;#KMS-Key-Management-Service&quot; class=&quot;headerlink&quot; title=&quot;KMS(Key Management Service)&quot;&gt;&lt;/a&gt;KMS(Key Management Service)&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Windows&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight cmd&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;// INSTALL&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;slmgr /ipk W269N-WFGWX-YVC9B-&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;J6C9-T83GX //GVKL&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;slmgr /skms domain.com //指定你自己的 Management Service ipaddress or domain&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;slmgr /ato //执行操作&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// UNINSTALL&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;slmgr /upk //卸载KEY&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;slmgr /ckms //清除IP地址&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;slmgr /rearm //重置授权状态&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;shutdown -r -t &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; //重启&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Windows" scheme="https://heyikang.me/tags/Windows/"/>
    
      <category term="GVLK" scheme="https://heyikang.me/tags/GVLK/"/>
    
  </entry>
  
  <entry>
    <title>ownCloud 基础优化</title>
    <link href="https://heyikang.me/2017/12/16/ownCloud-Optimization/"/>
    <id>https://heyikang.me/2017/12/16/ownCloud-Optimization/</id>
    <published>2017-12-15T20:13:32.000Z</published>
    <updated>2018-10-11T11:13:45.620Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>安装完成之后发现点击管理后有几个小问题。</p></blockquote><ul><li>事务文件锁定应配置为使用基于内存的锁定，而不是默认的基于慢速数据库的锁定。有关详细信息，请参阅 <a href="https://doc.owncloud.org/server/10.0/go.php?to=admin&gt;transactional-locking" target="_blank" rel="noopener">文档</a>。</li><li>我们建议启用系统 cron，任何其他 cron 方法可能对性能和可靠性有影响。</li><li>您正在通过 HTTP 访问该站点，我们强烈建议您按照安全提示配置服务器强制使用 HTTPS。</li><li>HTTP 严格传输安全（Strict-Transport-Security）报头未配置到至少“15552000”秒。处于增强安全性考虑，我们推荐按照安全提示启用 HSTS</li><li>内存缓存未配置。如果可用，请配置 memcache 来增强性能。更多信息请查看我们的文档。</li></ul><p><strong>更多安装信息请移步<a href="/2017/12/07/ownCloud-Deployment/">ownCloud 部署</a></strong><br><a id="more"></a></p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ul><li>CA颁发的证书，我这里使用的是腾讯云的证书，也是用的亚洲诚信的证书。</li></ul><h2 id="配置Redis"><a href="#配置Redis" class="headerlink" title="配置Redis"></a>配置Redis</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#yum install php70w-pecl-redis -y //安装支持组件</span></span><br><span class="line"><span class="comment">#yum install redis-server -y //安装Redis</span></span><br><span class="line"><span class="comment">#systemctl enable redis</span></span><br><span class="line"><span class="comment">#systemctl start redis</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vim /var/www/html/owncloud/config/config.php //编辑ownCldou配置文件</span></span><br></pre></td></tr></table></figure><blockquote><p>加入 <strong>Redis Configure</strong> 字段中的内容</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$CONFIG = <span class="keyword">array</span> (</span><br><span class="line">  <span class="string">'instanceid'</span> =&gt; <span class="string">'ocxhyr8g8cb6'</span>,</span><br><span class="line">  <span class="string">'passwordsalt'</span> =&gt; <span class="string">'NRY2nwU6iSmPqQEtLxS6J8PnTY/2+0'</span>,</span><br><span class="line">  <span class="string">'secret'</span> =&gt; <span class="string">'wqlck4NWOxE9wRqVm7AWRlb7fN8S95zI2hYk7EP4JFhWnTyL'</span>,</span><br><span class="line">  <span class="string">'trusted_domains'</span> =&gt;</span><br><span class="line">  <span class="keyword">array</span> (</span><br><span class="line">    <span class="number">0</span> =&gt; <span class="string">'10.4.22.71'</span>,</span><br><span class="line">    <span class="number">1</span> =&gt; <span class="string">'owncloud.cloud.cocobike.cn'</span>,</span><br><span class="line">  ),</span><br><span class="line">  <span class="string">'datadirectory'</span> =&gt; <span class="string">'/var/ownclouddata'</span>,</span><br><span class="line">  <span class="string">'overwrite.cli.url'</span> =&gt; <span class="string">'http://10.4.22.71/owncloud'</span>,</span><br><span class="line">  <span class="string">'dbtype'</span> =&gt; <span class="string">'mysql'</span>,</span><br><span class="line">  <span class="string">'version'</span> =&gt; <span class="string">'10.0.3.3'</span>,</span><br><span class="line">  <span class="string">'dbname'</span> =&gt; <span class="string">'owncloud'</span>,</span><br><span class="line">  <span class="string">'dbhost'</span> =&gt; <span class="string">'localhost'</span>,</span><br><span class="line">  <span class="string">'dbtableprefix'</span> =&gt; <span class="string">'oc_'</span>,</span><br><span class="line">  <span class="string">'dbuser'</span> =&gt; <span class="string">'owncloud'</span>,</span><br><span class="line">  <span class="string">'dbpassword'</span> =&gt; <span class="string">'password'</span>,</span><br><span class="line">  <span class="string">'logtimezone'</span> =&gt; <span class="string">'UTC'</span>,</span><br><span class="line">  <span class="string">'installed'</span> =&gt; <span class="keyword">true</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Redis Configure Start</span></span><br><span class="line">  <span class="string">'memcache.locking'</span> =&gt; <span class="string">'\\OC\\Memcache\\Redis'</span>,</span><br><span class="line">  <span class="string">'redis'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">  <span class="string">'host'</span> =&gt; <span class="string">'localhost'</span>,</span><br><span class="line">  <span class="string">'port'</span> =&gt; <span class="number">6379</span>,</span><br><span class="line">  ),</span><br><span class="line">  <span class="comment">// Redis Configure End</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#systemctl restart httpd //重启一下Apache</span></span><br></pre></td></tr></table></figure><h2 id="配置-CRON"><a href="#配置-CRON" class="headerlink" title="配置 CRON"></a>配置 CRON</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#cron -e -u apache //打开之后写入以下信息</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/15 * * * php -f /var/www/html/owncloud/cron.php</span><br></pre></td></tr></table></figure><blockquote><p>官方文档<a href="https://doc.owncloud.org/server/10.0/admin_manual/configuration/server/background_jobs_configuration.html" target="_blank" rel="noopener">链接</a></p></blockquote><h2 id="配置HTTPS"><a href="#配置HTTPS" class="headerlink" title="配置HTTPS"></a>配置HTTPS</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#yum install mod_ssl -y //安装Apache SSL/TLS 模块</span></span><br><span class="line"><span class="comment">#vim /etc/httpd/conf.d/ssl.conf  //编辑配置文件，制定密钥路径</span></span><br></pre></td></tr></table></figure><p> <code>SSLCertificateFile</code> 为你的公钥路径<br> <code>SSLCertificateKeyFile</code> 为你的私钥路径<br> <code>SSLCACertificateFile</code> 为你的CA密钥路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#chmod 0400 /root/sslKey/* //执行密钥文件 仅可读</span></span><br><span class="line"><span class="comment">#vim /etc/httpd/conf/httpd.conf  //修改配置文件</span></span><br></pre></td></tr></table></figure><p> <code>ServerName</code> 指定你的域名 比如我的 owncloud.cloud.cocobike.cn 在95行<br> <code>DocumentRoot</code> 指定你的根路径 “/var/www/html/owncloud” 在119行<br> <code>AllowOverride</code> 把None改为All 启用.htaccess 在151行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#httpd -t //检查httpd.conf 语法是否正确</span></span><br><span class="line"><span class="comment">#systemctl restart httpd</span></span><br></pre></td></tr></table></figure><h2 id="配置HSTS"><a href="#配置HSTS" class="headerlink" title="配置HSTS"></a>配置HSTS</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vim /etc/httpd/conf/httpd.conf //在最后添加下面字段即可</span></span><br><span class="line"><span class="comment">#systemctl restart httpd</span></span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;IfModule mod_headers.c&gt;</span></span><br><span class="line">  <span class="attribute"><span class="nomarkup">Header</span></span> always set Strict-Transport-Security <span class="string">"max-age=15552000; includeSubDomains; preload"</span></span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br></pre></td></tr></table></figure><h2 id="配置MemCache"><a href="#配置MemCache" class="headerlink" title="配置MemCache"></a>配置MemCache</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#yum install memcached -y</span></span><br><span class="line"><span class="comment">#yum install php70w-pecl-memcached -y</span></span><br><span class="line"><span class="comment">#systemctl enable memcached</span></span><br><span class="line"><span class="comment">#systemctl start memcached</span></span><br></pre></td></tr></table></figure><blockquote><p>配置config.php</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vim /var/www/html/owncloud/config/config.php</span></span><br></pre></td></tr></table></figure><blockquote><p>加入 <strong>Memcache Configure</strong> 字段中的内容</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$CONFIG = <span class="keyword">array</span> (</span><br><span class="line">  <span class="string">'instanceid'</span> =&gt; <span class="string">'ocxhyr8g8cb6'</span>,</span><br><span class="line">  <span class="string">'passwordsalt'</span> =&gt; <span class="string">'NRY2nwU6iSmPqQEtLxS6J8PnTY/2+0'</span>,</span><br><span class="line">  <span class="string">'secret'</span> =&gt; <span class="string">'wqlck4NWOxE9wRqVm7AWRlb7fN8S95zI2hYk7EP4JFhWnTyL'</span>,</span><br><span class="line">  <span class="string">'trusted_domains'</span> =&gt;</span><br><span class="line">  <span class="keyword">array</span> (</span><br><span class="line">    <span class="number">0</span> =&gt; <span class="string">'10.4.22.71'</span>,</span><br><span class="line">    <span class="number">1</span> =&gt; <span class="string">'owncloud.cloud.cocobike.cn'</span>,</span><br><span class="line">  ),</span><br><span class="line">  <span class="string">'datadirectory'</span> =&gt; <span class="string">'/var/ownclouddata'</span>,</span><br><span class="line">  <span class="string">'overwrite.cli.url'</span> =&gt; <span class="string">'http://10.4.22.71/owncloud'</span>,</span><br><span class="line">  <span class="string">'dbtype'</span> =&gt; <span class="string">'mysql'</span>,</span><br><span class="line">  <span class="string">'version'</span> =&gt; <span class="string">'10.0.3.3'</span>,</span><br><span class="line">  <span class="string">'dbname'</span> =&gt; <span class="string">'owncloud'</span>,</span><br><span class="line">  <span class="string">'dbhost'</span> =&gt; <span class="string">'localhost'</span>,</span><br><span class="line">  <span class="string">'dbtableprefix'</span> =&gt; <span class="string">'oc_'</span>,</span><br><span class="line">  <span class="string">'dbuser'</span> =&gt; <span class="string">'owncloud'</span>,</span><br><span class="line">  <span class="string">'dbpassword'</span> =&gt; <span class="string">'password'</span>,</span><br><span class="line">  <span class="string">'logtimezone'</span> =&gt; <span class="string">'UTC'</span>,</span><br><span class="line">  <span class="string">'installed'</span> =&gt; <span class="keyword">true</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Redis Configure Start</span></span><br><span class="line">  <span class="string">'memcache.locking'</span> =&gt; <span class="string">'\\OC\\Memcache\\Redis'</span>,</span><br><span class="line">  <span class="string">'redis'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">  <span class="string">'host'</span> =&gt; <span class="string">'localhost'</span>,</span><br><span class="line">  <span class="string">'port'</span> =&gt; <span class="number">6379</span>,</span><br><span class="line">  ),</span><br><span class="line">  <span class="comment">// Redis Configure End</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Memcache Configure Start</span></span><br><span class="line">  <span class="string">'memcache.local'</span> =&gt; <span class="string">'\\OC\\Memcache\\Memcached'</span>,</span><br><span class="line">  <span class="string">'memcached'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">      <span class="string">'host'</span> =&gt; <span class="string">'localhost'</span>,</span><br><span class="line">      <span class="string">'port'</span> =&gt; <span class="number">11211</span>,</span><br><span class="line">  ),</span><br><span class="line">  <span class="comment">// Memcache Configure End</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="配置SMBClient"><a href="#配置SMBClient" class="headerlink" title="配置SMBClient"></a>配置SMBClient</h2><blockquote><p>因为在之前的RPM的仓库里没有这个组件所以需要重新找一个</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#rpm -Uvh https://centos7.iuscommunity.org/ius-release.rpm</span></span><br><span class="line"><span class="comment">#yum install php70u-pecl-smbclient -y</span></span><br><span class="line"><span class="comment">#systemctl restart httpd</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;安装完成之后发现点击管理后有几个小问题。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;事务文件锁定应配置为使用基于内存的锁定，而不是默认的基于慢速数据库的锁定。有关详细信息，请参阅 &lt;a href=&quot;https://doc.owncloud.org/server/10.0/go.php?to=admin&amp;gt;transactional-locking&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;文档&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;我们建议启用系统 cron，任何其他 cron 方法可能对性能和可靠性有影响。&lt;/li&gt;
&lt;li&gt;您正在通过 HTTP 访问该站点，我们强烈建议您按照安全提示配置服务器强制使用 HTTPS。&lt;/li&gt;
&lt;li&gt;HTTP 严格传输安全（Strict-Transport-Security）报头未配置到至少“15552000”秒。处于增强安全性考虑，我们推荐按照安全提示启用 HSTS&lt;/li&gt;
&lt;li&gt;内存缓存未配置。如果可用，请配置 memcache 来增强性能。更多信息请查看我们的文档。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;更多安装信息请移步&lt;a href=&quot;/2017/12/07/ownCloud-Deployment/&quot;&gt;ownCloud 部署&lt;/a&gt;&lt;/strong&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="ownCloud" scheme="https://heyikang.me/tags/ownCloud/"/>
    
      <category term="CentOS7" scheme="https://heyikang.me/tags/CentOS7/"/>
    
  </entry>
  
  <entry>
    <title>ownCloud 部署</title>
    <link href="https://heyikang.me/2017/12/07/ownCloud-Deployment/"/>
    <id>https://heyikang.me/2017/12/07/ownCloud-Deployment/</id>
    <published>2017-12-06T16:45:12.000Z</published>
    <updated>2018-10-11T11:13:45.619Z</updated>
    
    <content type="html"><![CDATA[<p>现在差不多云盘都倒闭了，百度云感觉一点都不好用，所以尝试自己搭了。</p><h1 id="部署前准备工作"><a href="#部署前准备工作" class="headerlink" title="部署前准备工作"></a>部署前准备工作</h1><ol><li>我的硬件环境及开发环境请移步<a href="/about">about</a></li><li>确认你的电脑开启<a href="//baike.baidu.com/item/Intel%20VT/2091588?fr=aladdin">VT-x</a>或者<a href="https://baike.baidu.com/item/AMD-V" target="_blank" rel="noopener">AMD-V</a></li><li>CentOS 7镜像使用 <strong>DVD ISO</strong> <a href="https://www.centos.org/download/" target="_blank" rel="noopener">下载地址</a></li><li>SSH链接工具使用<a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/" target="_blank" rel="noopener">PuTTY</a>或其它你喜欢的工具</li></ol><h1 id="开始部署"><a href="#开始部署" class="headerlink" title="开始部署"></a>开始部署</h1><h2 id="更新系统"><a href="#更新系统" class="headerlink" title="更新系统"></a>更新系统</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#yum makecache      //建立元数据库</span></span><br><span class="line"><span class="comment">#yum update -y      //系统更新</span></span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="安装常用工具"><a href="#安装常用工具" class="headerlink" title="安装常用工具"></a>安装常用工具</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#yum install vim -y //个人习惯的的编辑器</span></span><br><span class="line"><span class="comment">#yum install bzip2 -y //bzip2 工具</span></span><br><span class="line"><span class="comment">#yum install unzip -y //zip 解压工具</span></span><br><span class="line"><span class="comment">#yum install wget -y //下载工具</span></span><br></pre></td></tr></table></figure><h2 id="安装Apache"><a href="#安装Apache" class="headerlink" title="安装Apache"></a>安装Apache</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#yum install httpd -y    //安装Apache</span></span><br><span class="line"><span class="comment">#httpd -V                //查看Apache版本</span></span><br><span class="line"><span class="comment">#systemctl start httpd   //启动Apache</span></span><br><span class="line"><span class="comment">#systemctl enable httpd  //设置开机启动</span></span><br><span class="line"><span class="comment">#systemctl status httpd  //查看Apache运行状态</span></span><br></pre></td></tr></table></figure><h2 id="安装PHP7"><a href="#安装PHP7" class="headerlink" title="安装PHP7"></a>安装PHP7</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#yum install epel-release -y    //安装 epel-release 仓库</span></span><br><span class="line"><span class="comment">#rpm -Uvh https://centos7.iuscommunity.org/ius-release.rpm    //安装 RPM 包</span></span><br><span class="line"><span class="comment">#yum makecache //再次建立元数据库 加快安装速度</span></span><br><span class="line"><span class="comment">#yum install php70u -y          //安装PHP主要文件 会自动安装 CLI COMMON 组件</span></span><br><span class="line"><span class="comment">#yum install php70u-fpm -y      // FastCGI 进程管理器</span></span><br><span class="line"><span class="comment">#yum install php70u-gd -y       // GD 图形库</span></span><br><span class="line"><span class="comment">#yum install php70u-mbstring -y // Mbstring 编码库</span></span><br><span class="line"><span class="comment">#yum install php70u-mysql -y    // MySQL 组件 会自动安装PDO组件</span></span><br><span class="line"><span class="comment">#yum install php70u-posix -y    // POSIX 组件</span></span><br><span class="line"><span class="comment">#yum install php70u-xml -y      // XML 组件</span></span><br><span class="line"><span class="comment">#yum install php70u-ldap -y     // LDAP 组件</span></span><br><span class="line"><span class="comment">#php -v //查看PHP 版本号</span></span><br></pre></td></tr></table></figure><h2 id="安装MariaDB"><a href="#安装MariaDB" class="headerlink" title="安装MariaDB"></a>安装MariaDB</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#yum install mariadb-server -y  //安装MariaDB</span></span><br><span class="line"><span class="comment">#mysql -V //查看MariaDB 版本号</span></span><br><span class="line"><span class="comment">#systemctl start mariadb </span></span><br><span class="line"><span class="comment">#systemctl enable mariadb </span></span><br><span class="line"><span class="comment">#systemctl status mariadb</span></span><br></pre></td></tr></table></figure><h2 id="初始化Mariadb"><a href="#初始化Mariadb" class="headerlink" title="初始化Mariadb"></a>初始化Mariadb</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#mysql_secure_installation;</span></span><br></pre></td></tr></table></figure><h3 id="初始化开始"><a href="#初始化开始" class="headerlink" title="初始化开始"></a>初始化开始</h3><ol><li><p>初始化提示</p><blockquote><p>NOTE: RUNING ALL PARTS OF THIS SCRIPT LS RECOMMENDED FOR AKK MariadDB<br>　　 　SERVERS IN PRODUCTION USE! FLEASE READ EACH STEP CAREFULLY!<br>　<br>In order to log into MariaDB to secure it, we’ll need the current<br>password for the root user. if you’ve just installed MariaDB, and<br>so you should just press enter here.<br>　<br>Enter current password for root (enter for none): <strong>Enter</strong></p></blockquote></li><li><p>设置密码</p><blockquote><p>Setting the root password ensures that nobody can log into the MariaDB<br>root user without the proper authorisation.<br>　<br>Set root password? [Y/n]  <strong>Enter</strong><br>New password: <strong>Password</strong><br>Re-enter new password: <strong>Password</strong></p></blockquote></li><li><p>是否删除匿名用户</p><blockquote><p>By Default, a MariaDB installation has an anonymouse user, allowing anyone<br>to log into MariDB witout having to have a user account created for<br>them. This is intended only for testing, and to make the installation<br>go a bit smoother. You shold remove them berfore moving into a<br>production enviroment.<br>　<br>Remove anonymous users? [Y/n] <strong>Enter</strong> </p></blockquote></li><li><p>是否禁止root远程访问</p><blockquote><p>Normally, root should only be allowed to connect form ‘localhost’. This<br>ensures that someone cannot guess at the root password from the network.<br>　<br>Disallow root login remotely? [Y/n] <strong>Enter</strong></p></blockquote></li><li><p>是否删除测试数据库</p><blockquote><p>By default, MariaDB comes with a database named ‘test’ that anyone can<br>access. This is also intended only for testing, and should be removed<br>before moving into a production environment.<br>　<br>Remove test database and access to it? [Y/n] <strong>Enter</strong></p></blockquote></li><li><p>是否刷新权限表</p><blockquote><p>Reloading the privilege tables will ensure that all changes mode so far<br>will take effect immediately<br>　<br>Reload privilege tables now? [Y/n] <strong>Enter</strong></p></blockquote></li><li><p>显示创建成功</p><blockquote><p>All done! If you’ve completed all of the above steps, your MariaDB<br>installation should now be secure<br>　<br>Thanks for using MariaDB!</p></blockquote></li><li><p>登陆MariaDB</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#mysql -u root -p //按Enter后输入你设置的密码</span></span><br></pre></td></tr></table></figure></li><li><p>创建表单</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MariDB [(none)]&gt; create database owncloud; </span><br><span class="line">MariDB [(none)]&gt; create user &apos;owncloud&apos;@&apos;localhost&apos; identified by&apos;password&apos;; </span><br><span class="line">MariDB [(none)]&gt; grant all on owncloud.* to &apos;owncloud&apos;@&apos;localhost&apos;; </span><br><span class="line">MariDB [(none)]&gt; flush privileges; </span><br><span class="line">MariDB [(none)]&gt; quit;</span><br></pre></td></tr></table></figure></li></ol><h2 id="ownCloud-部署"><a href="#ownCloud-部署" class="headerlink" title="ownCloud 部署"></a>ownCloud 部署</h2><h3 id="下载ownCloud"><a href="#下载ownCloud" class="headerlink" title="下载ownCloud"></a>下载ownCloud</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#wget https://download.owncloud.org/community/owncloud-10.0.3.tar.bz2 //下载ownCloud到当前目录</span></span><br></pre></td></tr></table></figure><h3 id="解压ownCloud"><a href="#解压ownCloud" class="headerlink" title="解压ownCloud"></a>解压ownCloud</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#tar -jxvf owncloud-10.0.3.tar.bz2 -C /var/www/html //解压ownCloud 到 /var/www/html 目录下</span></span><br></pre></td></tr></table></figure><h3 id="赋予用户和组权限"><a href="#赋予用户和组权限" class="headerlink" title="赋予用户和组权限"></a>赋予用户和组权限</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#chown -R apache.apache /var/www/html // R 表示递归 apache.apache 分别表示用户和组</span></span><br></pre></td></tr></table></figure><h2 id="配置Firewall"><a href="#配置Firewall" class="headerlink" title="配置Firewall"></a>配置Firewall</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#firewall-cmd --permanent --zone=public --add-service=http //永久开放Public 区域的 http 服务端口</span></span><br><span class="line"><span class="comment">#firewall-cmd --permanent --zone=public --add-service=https</span></span><br><span class="line"><span class="comment">#firewall-cmd --reload  //因为firewall-cmd 是动态 所以需要重新载入</span></span><br></pre></td></tr></table></figure><h2 id="配置SELinux"><a href="#配置SELinux" class="headerlink" title="配置SELinux"></a>配置SELinux</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#setenforce 0 //临时改变重启失效</span></span><br><span class="line"><span class="comment">#getenforce   //查看SELinux 状态</span></span><br><span class="line"><span class="comment">#vim /etc/selinux/config //永久改变</span></span><br></pre></td></tr></table></figure><ul><li>找到<code>SELINUX=enforcing</code>改成<code>SELINUX=disabled</code></li><li>按 <code>Esc</code> <code>:</code> <code>wq</code> <code>Enter</code> 即可保存退出 </li></ul><h2 id="修改存储位置"><a href="#修改存储位置" class="headerlink" title="修改存储位置"></a>修改存储位置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#mkdir /var/ownclouddata //创建文件夹</span></span><br><span class="line"><span class="comment">#chown -R apache.apache /var/ownclouddata</span></span><br></pre></td></tr></table></figure><h2 id="访问ownCloud页面"><a href="#访问ownCloud页面" class="headerlink" title="访问ownCloud页面"></a>访问ownCloud页面</h2><p>然后根据提示配置简单信息即可正常访问</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;现在差不多云盘都倒闭了，百度云感觉一点都不好用，所以尝试自己搭了。&lt;/p&gt;
&lt;h1 id=&quot;部署前准备工作&quot;&gt;&lt;a href=&quot;#部署前准备工作&quot; class=&quot;headerlink&quot; title=&quot;部署前准备工作&quot;&gt;&lt;/a&gt;部署前准备工作&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;我的硬件环境及开发环境请移步&lt;a href=&quot;/about&quot;&gt;about&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;确认你的电脑开启&lt;a href=&quot;//baike.baidu.com/item/Intel%20VT/2091588?fr=aladdin&quot;&gt;VT-x&lt;/a&gt;或者&lt;a href=&quot;https://baike.baidu.com/item/AMD-V&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;AMD-V&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;CentOS 7镜像使用 &lt;strong&gt;DVD ISO&lt;/strong&gt; &lt;a href=&quot;https://www.centos.org/download/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;下载地址&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;SSH链接工具使用&lt;a href=&quot;https://www.chiark.greenend.org.uk/~sgtatham/putty/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;PuTTY&lt;/a&gt;或其它你喜欢的工具&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&quot;开始部署&quot;&gt;&lt;a href=&quot;#开始部署&quot; class=&quot;headerlink&quot; title=&quot;开始部署&quot;&gt;&lt;/a&gt;开始部署&lt;/h1&gt;&lt;h2 id=&quot;更新系统&quot;&gt;&lt;a href=&quot;#更新系统&quot; class=&quot;headerlink&quot; title=&quot;更新系统&quot;&gt;&lt;/a&gt;更新系统&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#yum makecache      //建立元数据库&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#yum update -y      //系统更新&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="ownCloud" scheme="https://heyikang.me/tags/ownCloud/"/>
    
      <category term="CentOS7" scheme="https://heyikang.me/tags/CentOS7/"/>
    
  </entry>
  
</feed>
